
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cmdstanpy.model &#8212; CmdStanPy 1.2.1 documentation</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/project-template.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
<link rel="stylesheet" href="_static/basic.css" type="text/css" />

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
<nav id="navbar-main" class="navbar navbar-dark navbar-expand-lg fixed-top bd-navbar"
    style="background-color: #222222;"><div class="container-xl">

  <div id="navbar-start">
    
    <!-- This will display the version of the docs -->
<a class='navbar-brand' href='../../index.html'>CmdStanPy 1.2.1</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../users-guide.html">
  User’s Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../changes.html">
  What’s New
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../community.html">
  Community
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/mcmc_stan" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/stan-dev/cmdstanpy" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://discourse.mc-stan.org/" rel="noopener" target="_blank" title="Forums"><span><i class="fas fa-users"></i></span>
            <label class="sr-only">Forums</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
</nav>


    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for cmdstanpy.model</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;CmdStanModel&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">cpu_count</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">cmdstanpy</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_CMDSTAN_REFRESH</span><span class="p">,</span>
    <span class="n">_CMDSTAN_SAMPLING</span><span class="p">,</span>
    <span class="n">_CMDSTAN_WARMUP</span><span class="p">,</span>
    <span class="n">_TMPDIR</span><span class="p">,</span>
    <span class="n">compilation</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">cmdstanpy.cmdstan_args</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CmdStanArgs</span><span class="p">,</span>
    <span class="n">GenerateQuantitiesArgs</span><span class="p">,</span>
    <span class="n">LaplaceArgs</span><span class="p">,</span>
    <span class="n">Method</span><span class="p">,</span>
    <span class="n">OptimizeArgs</span><span class="p">,</span>
    <span class="n">PathfinderArgs</span><span class="p">,</span>
    <span class="n">SamplerArgs</span><span class="p">,</span>
    <span class="n">VariationalArgs</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">cmdstanpy.stanfit</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CmdStanGQ</span><span class="p">,</span>
    <span class="n">CmdStanLaplace</span><span class="p">,</span>
    <span class="n">CmdStanMCMC</span><span class="p">,</span>
    <span class="n">CmdStanMLE</span><span class="p">,</span>
    <span class="n">CmdStanPathfinder</span><span class="p">,</span>
    <span class="n">CmdStanVB</span><span class="p">,</span>
    <span class="n">RunSet</span><span class="p">,</span>
    <span class="n">from_csv</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">cmdstanpy.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EXTENSION</span><span class="p">,</span>
    <span class="n">cmdstan_path</span><span class="p">,</span>
    <span class="n">cmdstan_version</span><span class="p">,</span>
    <span class="n">cmdstan_version_before</span><span class="p">,</span>
    <span class="n">do_command</span><span class="p">,</span>
    <span class="n">get_logger</span><span class="p">,</span>
    <span class="n">returncode_msg</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">cmdstanpy.utils.filesystem</span> <span class="kn">import</span> <span class="n">temp_inits</span><span class="p">,</span> <span class="n">temp_single_json</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">progress</span> <span class="k">as</span> <span class="n">progbar</span>

<span class="n">OptionalPath</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">Fit</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;Fit&#39;</span><span class="p">,</span> <span class="n">CmdStanMCMC</span><span class="p">,</span> <span class="n">CmdStanMLE</span><span class="p">,</span> <span class="n">CmdStanVB</span><span class="p">)</span>


<div class="viewcode-block" id="CmdStanModel"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel">[docs]</a><span class="k">class</span> <span class="nc">CmdStanModel</span><span class="p">:</span>
    <span class="c1"># overview, omitted from doc comment in order to improve Sphinx docs.</span>
    <span class="c1">#    A CmdStanModel object encapsulates the Stan program and provides</span>
    <span class="c1">#    methods for compilation and inference.</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The constructor method allows model instantiation given either the</span>
<span class="sd">    Stan program source file or the compiled executable, or both.</span>
<span class="sd">    This will compile the model if provided a Stan file and no executable,</span>

<span class="sd">    :param model_name: Model name, used for output file names.</span>
<span class="sd">        Optional, default is the base filename of the Stan program file.</span>
<span class="sd">        Deprecated: In version 2.0.0, model name cannot be</span>
<span class="sd">        specified and will always be taken from executable.</span>

<span class="sd">    :param stan_file: Path to Stan program file.</span>

<span class="sd">    :param exe_file: Path to compiled executable file.  Optional, unless</span>
<span class="sd">        no Stan program file is specified.  If both the program file and</span>
<span class="sd">        the compiled executable file are specified, the base filenames</span>
<span class="sd">        must match, (but different directory locations are allowed).</span>

<span class="sd">    :param force_compile: If ``True``, always compile, even if there</span>
<span class="sd">        is an existing executable file for this model.</span>

<span class="sd">    :param stanc_options: Options for stanc compiler, specified as a Python</span>
<span class="sd">        dictionary containing Stanc3 compiler option name, value pairs.</span>
<span class="sd">        Optional.</span>

<span class="sd">    :param cpp_options: Options for C++ compiler, specified as a Python</span>
<span class="sd">        dictionary containing C++ compiler option name, value pairs.</span>
<span class="sd">        Optional.</span>

<span class="sd">    :param user_header: A path to a header file to include during C++</span>
<span class="sd">        compilation.</span>
<span class="sd">        Optional.</span>

<span class="sd">    :param compile: Whether or not to compile the model.  Default is ``True``.</span>
<span class="sd">        If set to the string ``&quot;force&quot;``, it will always compile even if</span>
<span class="sd">        an existing executable is found.</span>
<span class="sd">        Deprecated: Use ``force_compile`` instead. The ability to instantiate</span>
<span class="sd">        a CmdStanModel without an executable will be removed in version 2.0.0.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stan_file</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exe_file</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_compile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">stanc_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cpp_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user_header</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="nb">compile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize object given constructor args.</span>

<span class="sd">        :param model_name: Deprecated. Model name, used for output file names.</span>
<span class="sd">        :param stan_file: Path to Stan program file.</span>
<span class="sd">        :param exe_file: Path to compiled executable file.</span>
<span class="sd">        :param force_compile: Whether or not to force recompilation if</span>
<span class="sd">            executable file already exists.</span>
<span class="sd">        :param stanc_options: Options for stanc compiler.</span>
<span class="sd">        :param cpp_options: Options for C++ compiler.</span>
<span class="sd">        :param user_header: A path to a header file to include during C++</span>
<span class="sd">            compilation.</span>
<span class="sd">        :param compile: Deprecated. Whether or not to compile the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span> <span class="o">=</span> <span class="n">compilation</span><span class="o">.</span><span class="n">CompilerOptions</span><span class="p">(</span>
            <span class="n">stanc_options</span><span class="o">=</span><span class="n">stanc_options</span><span class="p">,</span>
            <span class="n">cpp_options</span><span class="o">=</span><span class="n">cpp_options</span><span class="p">,</span>
            <span class="n">user_header</span><span class="o">=</span><span class="n">user_header</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_param</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">compile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">compile</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;CmdStanModel(compile=...) is deprecated and will be &quot;</span>
                <span class="s2">&quot;removed in the next major version. The constructor will &quot;</span>
                <span class="s2">&quot;always ensure a model has a compiled executable.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;If you wish to force recompilation, use force_compile=True &quot;</span>
                <span class="s2">&quot;instead.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">force_compile</span><span class="p">:</span>
            <span class="nb">compile</span> <span class="o">=</span> <span class="s1">&#39;force&#39;</span>

        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;CmdStanModel(model_name=...) is deprecated and will be &quot;</span>
                <span class="s2">&quot;removed in the next major version.&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">model_name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Invalid value for argument model name, found &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">model_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">model_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">stan_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exe_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Missing model file arguments, you must specify &#39;</span>
                    <span class="s1">&#39;either Stan source or executable program file or both.&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">stan_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;no such file </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">))</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">stan_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.stan&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;invalid stan filename </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="c1"># if program has include directives, record path</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">program</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;#include&#39;</span> <span class="ow">in</span> <span class="n">program</span><span class="p">:</span>
                <span class="n">path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">add_include_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># try to detect models w/out parameters, needed for sampler</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmdstan_version_before</span><span class="p">(</span>
                <span class="mi">2</span><span class="p">,</span> <span class="mi">27</span>
            <span class="p">):</span>  <span class="c1"># unknown end of version range</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">model_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_info</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;parameters&#39;</span> <span class="ow">in</span> <span class="n">model_info</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_param</span> <span class="o">|=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">compile</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exe_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">exe_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;no such file </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">))</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">exename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">exename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">exename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;Name mismatch between Stan file and compiled&#39;</span>
                        <span class="s1">&#39; executable, expecting basename: </span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="s1">&#39; found: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">exename</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">do_command</span><span class="p">([</span><span class="s1">&#39;where.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;tbb.dll&#39;</span><span class="p">],</span> <span class="n">fd_out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="c1"># Add tbb to the $PATH on Windows</span>
                <span class="n">libtbb</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;STAN_TBB&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">libtbb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">libtbb</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">cmdstan_path</span><span class="p">(),</span> <span class="s1">&#39;stan&#39;</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;stan_math&#39;</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;tbb&#39;</span>
                    <span class="p">)</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding TBB (</span><span class="si">%s</span><span class="s2">) to PATH&quot;</span><span class="p">,</span> <span class="n">libtbb</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span>
                        <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">libtbb</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;TBB already found in load path&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">compile</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">compile</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;force&#39;</span><span class="p">,</span> <span class="n">_internal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="nb">repr</span> <span class="o">=</span> <span class="s1">&#39;CmdStanModel: name=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
        <span class="nb">repr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n\t</span><span class="s1"> stan_file=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">)</span>
        <span class="nb">repr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n\t</span><span class="s1"> exe_file=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">)</span>
        <span class="nb">repr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n\t</span><span class="s1"> compiler_options=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">repr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model name used in output filename templates. Default is basename</span>
<span class="sd">        of Stan program or exe file, unless specified in call to constructor</span>
<span class="sd">        via argument ``model_name``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stan_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptionalPath</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Full path to Stan program file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exe_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptionalPath</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Full path to Stan exe file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span>

<div class="viewcode-block" id="CmdStanModel.exe_info"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.exe_info">[docs]</a>    <span class="k">def</span> <span class="nf">exe_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run model with option &#39;info&#39;. Parse output statements, which all</span>
<span class="sd">        have form &#39;key = value&#39; into a Dict.</span>
<span class="sd">        If exe file compiled with CmdStan &lt; 2.27, option &#39;info&#39; isn&#39;t</span>
<span class="sd">        available and the method returns an empty dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
            <span class="n">do_command</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exe_file</span><span class="p">),</span> <span class="s1">&#39;info&#39;</span><span class="p">],</span> <span class="n">fd_out</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">kv_pair</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kv_pair</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">result</span><span class="p">[</span><span class="n">kv_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kv_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="CmdStanModel.src_info"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.src_info">[docs]</a>    <span class="k">def</span> <span class="nf">src_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run stanc with option &#39;--info&#39;.</span>

<span class="sd">        If stanc is older than 2.27 or if the stan</span>
<span class="sd">        file cannot be found, returns an empty dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">27</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">compilation</span><span class="o">.</span><span class="n">src_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="p">)</span></div>

<div class="viewcode-block" id="CmdStanModel.format"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">overwrite_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">canonicalize</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">max_line_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">78</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">backup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run stanc&#39;s auto-formatter on the model code. Either saves directly</span>
<span class="sd">        back to the file or prints for inspection</span>


<span class="sd">        :param overwrite_file: If True, save the updated code to disk, rather</span>
<span class="sd">            than printing it. By default False</span>
<span class="sd">        :param canonicalize: Whether or not the compiler should &#39;canonicalize&#39;</span>
<span class="sd">            the Stan model, removing things like deprecated syntax. Default is</span>
<span class="sd">            False. If True, all canonicalizations are run. If it is a list of</span>
<span class="sd">            strings, those options are passed to stanc (new in Stan 2.29)</span>
<span class="sd">        :param max_line_length: Set the wrapping point for the formatter. The</span>
<span class="sd">            default value is 78, which wraps most lines by the 80th character.</span>
<span class="sd">        :param backup: If True, create a stanfile.bak backup before</span>
<span class="sd">            writing to the file. Only disable this if you&#39;re sure you have other</span>
<span class="sd">            copies of the file or are using a version control system like Git.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No Stan file found for this module&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmdstan_path</span><span class="p">(),</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;stanc&#39;</span> <span class="o">+</span> <span class="n">EXTENSION</span><span class="p">)]</span>
                <span class="c1"># handle include-paths, allow-undefined etc</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">compose_stanc</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span><span class="p">)]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">canonicalize</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">canonicalize</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--print-canonical&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Invalid arguments passed for current CmdStan&quot;</span>
                            <span class="o">+</span> <span class="s2">&quot; version(</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">cmdstan_version</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Unknown&quot;</span>
                            <span class="p">)</span>
                            <span class="o">+</span> <span class="s2">&quot;--canonicalize requires 2.29 or higher&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">canonicalize</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--canonicalize=&#39;</span> <span class="o">+</span> <span class="n">canonicalize</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">canonicalize</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--canonicalize=&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">canonicalize</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--print-canonical&#39;</span><span class="p">)</span>

            <span class="c1"># before 2.29, having both --print-canonical</span>
            <span class="c1"># and --auto-format printed twice</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span> <span class="ow">and</span> <span class="n">canonicalize</span><span class="p">):</span>
                <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--auto-format&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">):</span>
                <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--max-line-length=</span><span class="si">{</span><span class="n">max_line_length</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">max_line_length</span> <span class="o">!=</span> <span class="mi">78</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid arguments passed for current CmdStan version&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; (</span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmdstan_version</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;--max-line-length requires 2.29 or higher&quot;</span>
                <span class="p">)</span>

            <span class="n">out</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">stdout</span>
            <span class="k">if</span> <span class="n">overwrite_file</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">backup</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span><span class="p">)</span>
                            <span class="o">+</span> <span class="s1">&#39;.bak-&#39;</span>
                            <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handle</span><span class="p">:</span>
                        <span class="n">file_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Stanc formatting failed&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stanc_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Options to stanc compilers.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">_stanc_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cpp_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Options to C++ compilers.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">_cpp_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The user header file if it exists, otherwise empty&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">_user_header</span>

<div class="viewcode-block" id="CmdStanModel.code"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.code">[docs]</a>    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return Stan program as a string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Please specify source file&#39;</span><span class="p">)</span>

        <span class="n">code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;Cannot read file Stan file: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">code</span></div>

    <span class="c1"># TODO(2.0): remove</span>
<div class="viewcode-block" id="CmdStanModel.compile"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">stanc_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cpp_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user_header</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">override_options</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">_internal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deprecated: To compile a model, use the :class:`~cmdstanpy.CmdStanModel`</span>
<span class="sd">        constructor or :func:`cmdstanpy.compile_stan_file()`.</span>

<span class="sd">        Compile the given Stan program file.  Translates the Stan code to</span>
<span class="sd">        C++, then calls the C++ compiler.</span>

<span class="sd">        By default, this function compares the timestamps on the source and</span>
<span class="sd">        executable files; if the executable is newer than the source file, it</span>
<span class="sd">        will not recompile the file, unless argument ``force`` is ``True``</span>
<span class="sd">        or unless the compiler options have been changed.</span>

<span class="sd">        :param force: When ``True``, always compile, even if the executable file</span>
<span class="sd">            is newer than the source file.  Used for Stan models which have</span>
<span class="sd">            ``#include`` directives in order to force recompilation when changes</span>
<span class="sd">            are made to the included files.</span>

<span class="sd">        :param stanc_options: Options for stanc compiler.</span>
<span class="sd">        :param cpp_options: Options for C++ compiler.</span>
<span class="sd">        :param user_header: A path to a header file to include during C++</span>
<span class="sd">            compilation.</span>

<span class="sd">        :param override_options: When ``True``, override existing option.</span>
<span class="sd">            When ``False``, add/replace existing options.  Default is ``False``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_internal</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;CmdStanModel.compile() is deprecated and will be removed in &quot;</span>
                <span class="s2">&quot;the next major version. To compile a model, use the &quot;</span>
                <span class="s2">&quot;CmdStanModel() constructor or cmdstanpy.compile_stan_file().&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stan_file</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Please specify source file&#39;</span><span class="p">)</span>

        <span class="n">compiler_options</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">stanc_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">cpp_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">user_header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">compiler_options</span> <span class="o">=</span> <span class="n">compilation</span><span class="o">.</span><span class="n">CompilerOptions</span><span class="p">(</span>
                <span class="n">stanc_options</span><span class="o">=</span><span class="n">stanc_options</span><span class="p">,</span>
                <span class="n">cpp_options</span><span class="o">=</span><span class="n">cpp_options</span><span class="p">,</span>
                <span class="n">user_header</span><span class="o">=</span><span class="n">user_header</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">compiler_options</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">compiler_options</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="p">:</span>
                <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span> <span class="o">=</span> <span class="n">compiler_options</span>
                <span class="k">elif</span> <span class="n">override_options</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span> <span class="o">=</span> <span class="n">compiler_options</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">compiler_options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span> <span class="o">=</span> <span class="n">compilation</span><span class="o">.</span><span class="n">compile_stan_file</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stan_file</span><span class="p">),</span>
            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
            <span class="n">stanc_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">stanc_options</span><span class="p">,</span>
            <span class="n">cpp_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">cpp_options</span><span class="p">,</span>
            <span class="n">user_header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compiler_options</span><span class="o">.</span><span class="n">user_header</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CmdStanModel.optimize"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.optimize">[docs]</a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sig_figs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_profile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">init_alpha</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_rel_obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_grad</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_rel_grad</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_param</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">history_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">iter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_iterations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">require_converged</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">jacobian</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># would be nice to move this further up, but that&#39;s a breaking change</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CmdStanMLE</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the specified CmdStan optimize algorithm to produce a</span>
<span class="sd">        penalized maximum likelihood estimate of the model parameters.</span>

<span class="sd">        This function validates the specified configuration, composes a call to</span>
<span class="sd">        the CmdStan ``optimize`` method and spawns one subprocess to run the</span>
<span class="sd">        optimizer and waits for it to run to completion.</span>
<span class="sd">        Unspecified arguments are not included in the call to CmdStan, i.e.,</span>
<span class="sd">        those arguments will have CmdStan default values.</span>

<span class="sd">        The :class:`CmdStanMLE` object records the command, the return code,</span>
<span class="sd">        and the paths to the optimize method output CSV and console files.</span>
<span class="sd">        The output files are written either to a specified output directory</span>
<span class="sd">        or to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        Output files are either written to a temporary directory or to the</span>
<span class="sd">        specified output directory.  Output filenames correspond to the template</span>
<span class="sd">        &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-&lt;chain_id&gt;&#39; plus the file suffix which is</span>
<span class="sd">        either &#39;.csv&#39; for the CmdStan output or &#39;.txt&#39; for</span>
<span class="sd">        the console messages, e.g. &#39;bernoulli-201912081451-1.csv&#39;.</span>
<span class="sd">        Output files written to the temporary directory contain an additional</span>
<span class="sd">        8-character random string, e.g. &#39;bernoulli-201912081451-1-5nm6as7u.csv&#39;.</span>

<span class="sd">        :param data: Values for all data variables in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the data variables,</span>
<span class="sd">            or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">        :param seed: The seed for random number generator. Must be an integer</span>
<span class="sd">            between 0 and 2^32 - 1. If unspecified,</span>
<span class="sd">            :func:`numpy.random.default_rng` is used to generate a seed.</span>

<span class="sd">        :param inits:  Specifies how the sampler initializes parameter values.</span>
<span class="sd">            Initialization is either uniform random on a range centered on 0,</span>
<span class="sd">            exactly 0, or a dictionary or file of initial values for some or</span>
<span class="sd">            all parameters in the model.  The default initialization behavior</span>
<span class="sd">            will initialize all parameter values on range [-2, 2] on the</span>
<span class="sd">            *unconstrained* support.  If the expected parameter values are</span>
<span class="sd">            too far from this range, this option may improve estimation.</span>
<span class="sd">            The following value types are allowed:</span>

<span class="sd">            * Single number, n &gt; 0 - initialization range is [-n, n].</span>
<span class="sd">            * 0 - all parameters are initialized to 0.</span>
<span class="sd">            * dictionary - pairs parameter name : initial value.</span>
<span class="sd">            * string - pathname to a JSON or Rdump data file.</span>

<span class="sd">        :param output_dir: Name of the directory to which CmdStan output</span>
<span class="sd">            files are written. If unspecified, output files will be written</span>
<span class="sd">            to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        :param sig_figs: Numerical precision used for output CSV and text files.</span>
<span class="sd">            Must be an integer between 1 and 18.  If unspecified, the default</span>
<span class="sd">            precision for the system file I/O is used; the usual value is 6.</span>
<span class="sd">            Introduced in CmdStan-2.25.</span>

<span class="sd">        :param save_profile: Whether or not to profile auto-diff operations in</span>
<span class="sd">            labelled blocks of code.  If ``True``, CSV outputs are written to</span>
<span class="sd">            file &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-profile-&lt;chain_id&gt;&#39;.</span>
<span class="sd">            Introduced in CmdStan-2.26.</span>

<span class="sd">        :param algorithm: Algorithm to use. One of: &#39;BFGS&#39;, &#39;LBFGS&#39;, &#39;Newton&#39;</span>

<span class="sd">        :param init_alpha: Line search step size for first iteration</span>

<span class="sd">        :param tol_obj: Convergence tolerance on changes in objective</span>
<span class="sd">            function value</span>

<span class="sd">        :param tol_rel_obj: Convergence tolerance on relative changes</span>
<span class="sd">            in objective function value</span>

<span class="sd">        :param tol_grad: Convergence tolerance on the norm of the gradient</span>

<span class="sd">        :param tol_rel_grad: Convergence tolerance on the relative</span>
<span class="sd">            norm of the gradient</span>

<span class="sd">        :param tol_param: Convergence tolerance on changes in parameter value</span>

<span class="sd">        :param history_size: Size of the history for LBFGS Hessian</span>
<span class="sd">            approximation. The value should be less than the dimensionality</span>
<span class="sd">            of the parameter space. 5-10 usually sufficient</span>

<span class="sd">        :param iter: Total number of iterations</span>

<span class="sd">        :param save_iterations: When ``True``, save intermediate approximations</span>
<span class="sd">            to the output CSV file.  Default is ``False``.</span>

<span class="sd">        :param require_converged: Whether or not to raise an error if Stan</span>
<span class="sd">            reports that &quot;The algorithm may not have converged&quot;.</span>

<span class="sd">        :param show_console: If ``True``, stream CmdStan messages sent to</span>
<span class="sd">            stdout and stderr to the console.  Default is ``False``.</span>

<span class="sd">        :param refresh: Specify the number of iterations cmdstan will take</span>
<span class="sd">            between progress messages. Default value is 100.</span>

<span class="sd">        :param time_fmt: A format string passed to</span>
<span class="sd">            :meth:`~datetime.datetime.strftime` to decide the file names for</span>
<span class="sd">            output CSVs. Defaults to &quot;%Y%m%d%H%M%S&quot;</span>

<span class="sd">        :param timeout: Duration at which optimization times out in seconds.</span>

<span class="sd">        :param jacobian: Whether or not to use the Jacobian adjustment for</span>
<span class="sd">            constrained variables in optimization. By default this is false,</span>
<span class="sd">            meaning optimization yields the Maximum Likehood Estimate (MLE).</span>
<span class="sd">            Setting it to true yields the Maximum A Posteriori Estimate (MAP).</span>

<span class="sd">        :return: CmdStanMLE object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">optimize_args</span> <span class="o">=</span> <span class="n">OptimizeArgs</span><span class="p">(</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
            <span class="n">init_alpha</span><span class="o">=</span><span class="n">init_alpha</span><span class="p">,</span>
            <span class="n">tol_obj</span><span class="o">=</span><span class="n">tol_obj</span><span class="p">,</span>
            <span class="n">tol_rel_obj</span><span class="o">=</span><span class="n">tol_rel_obj</span><span class="p">,</span>
            <span class="n">tol_grad</span><span class="o">=</span><span class="n">tol_grad</span><span class="p">,</span>
            <span class="n">tol_rel_grad</span><span class="o">=</span><span class="n">tol_rel_grad</span><span class="p">,</span>
            <span class="n">tol_param</span><span class="o">=</span><span class="n">tol_param</span><span class="p">,</span>
            <span class="n">history_size</span><span class="o">=</span><span class="n">history_size</span><span class="p">,</span>
            <span class="nb">iter</span><span class="o">=</span><span class="nb">iter</span><span class="p">,</span>
            <span class="n">save_iterations</span><span class="o">=</span><span class="n">save_iterations</span><span class="p">,</span>
            <span class="n">jacobian</span><span class="o">=</span><span class="n">jacobian</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">jacobian</span> <span class="ow">and</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe_info</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Jacobian adjustment for optimization is only supported &quot;</span>
                <span class="s2">&quot;in CmdStan 2.32 and above.&quot;</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="n">temp_single_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">_data</span><span class="p">,</span> <span class="n">temp_inits</span><span class="p">(</span>
            <span class="n">inits</span><span class="p">,</span> <span class="n">allow_multiple</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">_inits</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">CmdStanArgs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">,</span>
                <span class="n">chain_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">_data</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="n">inits</span><span class="o">=</span><span class="n">_inits</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
                <span class="n">sig_figs</span><span class="o">=</span><span class="n">sig_figs</span><span class="p">,</span>
                <span class="n">save_profile</span><span class="o">=</span><span class="n">save_profile</span><span class="p">,</span>
                <span class="n">method_args</span><span class="o">=</span><span class="n">optimize_args</span><span class="p">,</span>
                <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dummy_chain_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">runset</span> <span class="o">=</span> <span class="n">RunSet</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_fmt</span><span class="o">=</span><span class="n">time_fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_cmdstan</span><span class="p">(</span>
                <span class="n">runset</span><span class="p">,</span>
                <span class="n">dummy_chain_id</span><span class="p">,</span>
                <span class="n">show_console</span><span class="o">=</span><span class="n">show_console</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">runset</span><span class="o">.</span><span class="n">raise_for_timeouts</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">runset</span><span class="o">.</span><span class="n">_check_retcodes</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error during optimization! Command &#39;</span><span class="si">{}</span><span class="s2">&#39; failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">runset</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">runset</span><span class="o">.</span><span class="n">get_err_msgs</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Line search failed&#39;</span> <span class="ow">in</span> <span class="n">msg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">require_converged</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">mle</span> <span class="o">=</span> <span class="n">CmdStanMLE</span><span class="p">(</span><span class="n">runset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mle</span></div>

    <span class="c1"># pylint: disable=too-many-arguments</span>
<div class="viewcode-block" id="CmdStanModel.sample"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chains</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parallel_chains</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">threads_per_chain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chain_ids</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
            <span class="nb">float</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">,</span>
            <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
            <span class="n">List</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">iter_warmup</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">iter_sampling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_warmup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">thin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_treedepth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">step_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adapt_engaged</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">adapt_delta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adapt_init_phase</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adapt_metric_window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adapt_step_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fixed_param</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sig_figs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_latent_dynamics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">save_profile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">force_one_process_per_chain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CmdStanMCMC</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run or more chains of the NUTS-HMC sampler to produce a set of draws</span>
<span class="sd">        from the posterior distribution of a model conditioned on some data.</span>

<span class="sd">        This function validates the specified configuration, composes a call to</span>
<span class="sd">        the CmdStan ``sample`` method and spawns one subprocess per chain to run</span>
<span class="sd">        the sampler and waits for all chains to run to completion.</span>
<span class="sd">        Unspecified arguments are not included in the call to CmdStan, i.e.,</span>
<span class="sd">        those arguments will have CmdStan default values.</span>

<span class="sd">        For each chain, the :class:`CmdStanMCMC` object records the command,</span>
<span class="sd">        the return code, the sampler output file paths, and the corresponding</span>
<span class="sd">        console outputs, if any. The output files are written either to a</span>
<span class="sd">        specified output directory or to a temporary directory which is deleted</span>
<span class="sd">        upon session exit.</span>

<span class="sd">        Output files are either written to a temporary directory or to the</span>
<span class="sd">        specified output directory.  Ouput filenames correspond to the template</span>
<span class="sd">        &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-&lt;chain_id&gt;&#39; plus the file suffix which is</span>
<span class="sd">        either &#39;.csv&#39; for the CmdStan output or &#39;.txt&#39; for</span>
<span class="sd">        the console messages, e.g. &#39;bernoulli-201912081451-1.csv&#39;.</span>
<span class="sd">        Output files written to the temporary directory contain an additional</span>
<span class="sd">        8-character random string, e.g. &#39;bernoulli-201912081451-1-5nm6as7u.csv&#39;.</span>

<span class="sd">        :param data: Values for all data variables in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the data variables,</span>
<span class="sd">            or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">        :param chains: Number of sampler chains, must be a positive integer.</span>

<span class="sd">        :param parallel_chains: Number of processes to run in parallel. Must be</span>
<span class="sd">            a positive integer.  Defaults to :func:`multiprocessing.cpu_count`,</span>
<span class="sd">            i.e., it will only run as many chains in parallel as there are</span>
<span class="sd">            cores on the machine.   Note that CmdStan 2.28 and higher can run</span>
<span class="sd">            all chains in parallel providing that the model was compiled with</span>
<span class="sd">            threading support.</span>

<span class="sd">        :param threads_per_chain: The number of threads to use in parallelized</span>
<span class="sd">            sections within an MCMC chain (e.g., when using the Stan functions</span>
<span class="sd">            ``reduce_sum()``  or ``map_rect()``).  This will only have an effect</span>
<span class="sd">            if the model was compiled with threading support.  For such models,</span>
<span class="sd">            CmdStan version 2.28 and higher will run all chains in parallel</span>
<span class="sd">            from within a single process.  The total number of threads used</span>
<span class="sd">            will be ``parallel_chains * threads_per_chain``, where the default</span>
<span class="sd">            value for parallel_chains is the number of cpus, not chains.</span>

<span class="sd">        :param seed: The seed for random number generator. Must be an integer</span>
<span class="sd">            between 0 and 2^32 - 1. If unspecified,</span>
<span class="sd">            :func:`numpy.random.default_rng`</span>
<span class="sd">            is used to generate a seed which will be used for all chains.</span>
<span class="sd">            When the same seed is used across all chains,</span>
<span class="sd">            the chain-id is used to advance the RNG to avoid dependent samples.</span>

<span class="sd">        :param chain_ids: The offset for the random number generator, either</span>
<span class="sd">            an integer or a list of unique per-chain offsets.  If unspecified,</span>
<span class="sd">            chain ids are numbered sequentially starting from 1.</span>

<span class="sd">        :param inits: Specifies how the sampler initializes parameter values.</span>
<span class="sd">            Initialization is either uniform random on a range centered on 0,</span>
<span class="sd">            exactly 0, or a dictionary or file of initial values for some or all</span>
<span class="sd">            parameters in the model.  The default initialization behavior will</span>
<span class="sd">            initialize all parameter values on range [-2, 2] on the</span>
<span class="sd">            *unconstrained* support.  If the expected parameter values are</span>
<span class="sd">            too far from this range, this option may improve adaptation.</span>
<span class="sd">            The following value types are allowed:</span>

<span class="sd">            * Single number n &gt; 0 - initialization range is [-n, n].</span>
<span class="sd">            * 0 - all parameters are initialized to 0.</span>
<span class="sd">            * dictionary - pairs parameter name : initial value.</span>
<span class="sd">            * string - pathname to a JSON or Rdump data file.</span>
<span class="sd">            * list of strings - per-chain pathname to data file.</span>
<span class="sd">            * list of dictionaries - per-chain initial values.</span>

<span class="sd">        :param iter_warmup: Number of warmup iterations for each chain.</span>

<span class="sd">        :param iter_sampling: Number of draws from the posterior for each</span>
<span class="sd">            chain.</span>

<span class="sd">        :param save_warmup: When ``True``, sampler saves warmup draws as part of</span>
<span class="sd">            the Stan CSV output file.</span>

<span class="sd">        :param thin: Period between recorded iterations.  Default is 1, i.e.,</span>
<span class="sd">             all iterations are recorded.</span>

<span class="sd">        :param max_treedepth: Maximum depth of trees evaluated by NUTS sampler</span>
<span class="sd">            per iteration.</span>

<span class="sd">        :param metric: Specification of the mass matrix, either as a</span>
<span class="sd">            vector consisting of the diagonal elements of the covariance</span>
<span class="sd">            matrix (&#39;diag&#39; or &#39;diag_e&#39;) or the full covariance matrix</span>
<span class="sd">            (&#39;dense&#39; or &#39;dense_e&#39;).</span>

<span class="sd">            If the value of the metric argument is a string other than</span>
<span class="sd">            &#39;diag&#39;, &#39;diag_e&#39;, &#39;dense&#39;, or &#39;dense_e&#39;, it must be</span>
<span class="sd">            a valid filepath to a JSON or Rdump file which contains an entry</span>
<span class="sd">            &#39;inv_metric&#39; whose value is either the diagonal vector or</span>
<span class="sd">            the full covariance matrix.</span>

<span class="sd">            If the value of the metric argument is a list of paths, its</span>
<span class="sd">            length must match the number of chains and all paths must be</span>
<span class="sd">            unique.</span>

<span class="sd">            If the value of the metric argument is a Python dict object, it</span>
<span class="sd">            must contain an entry &#39;inv_metric&#39; which specifies either the</span>
<span class="sd">            diagnoal or dense matrix.</span>

<span class="sd">            If the value of the metric argument is a list of Python dicts,</span>
<span class="sd">            its length must match the number of chains and all dicts must</span>
<span class="sd">            containan entry &#39;inv_metric&#39; and all &#39;inv_metric&#39; entries must</span>
<span class="sd">            have the same shape.</span>

<span class="sd">        :param step_size: Initial step size for HMC sampler.  The value is</span>
<span class="sd">            either a single number or a list of numbers which will be used</span>
<span class="sd">            as the global or per-chain initial step size, respectively.</span>
<span class="sd">            The length of the list of step sizes must match the number of</span>
<span class="sd">            chains.</span>

<span class="sd">        :param adapt_engaged: When ``True``, adapt step size and metric.</span>

<span class="sd">        :param adapt_delta: Adaptation target Metropolis acceptance rate.</span>
<span class="sd">            The default value is 0.8.  Increasing this value, which must be</span>
<span class="sd">            strictly less than 1, causes adaptation to use smaller step sizes</span>
<span class="sd">            which improves the effective sample size, but may increase the time</span>
<span class="sd">            per iteration.</span>

<span class="sd">        :param adapt_init_phase: Iterations for initial phase of adaptation</span>
<span class="sd">            during which step size is adjusted so that the chain converges</span>
<span class="sd">            towards the typical set.</span>

<span class="sd">        :param adapt_metric_window: The second phase of adaptation tunes</span>
<span class="sd">            the metric and step size in a series of intervals.  This parameter</span>
<span class="sd">            specifies the number of iterations used for the first tuning</span>
<span class="sd">            interval; window size increases for each subsequent interval.</span>

<span class="sd">        :param adapt_step_size: Number of iterations given over to adjusting</span>
<span class="sd">            the step size given the tuned metric during the final phase of</span>
<span class="sd">            adaptation.</span>

<span class="sd">        :param fixed_param: When ``True``, call CmdStan with argument</span>
<span class="sd">            ``algorithm=fixed_param`` which runs the sampler without</span>
<span class="sd">            updating the Markov Chain, thus the values of all parameters and</span>
<span class="sd">            transformed parameters are constant across all draws and</span>
<span class="sd">            only those values in the generated quantities block that are</span>
<span class="sd">            produced by RNG functions may change.  This provides</span>
<span class="sd">            a way to use Stan programs to generate simulated data via the</span>
<span class="sd">            generated quantities block.  Default value is ``False``.</span>

<span class="sd">        :param output_dir: Name of the directory to which CmdStan output</span>
<span class="sd">            files are written. If unspecified, output files will be written</span>
<span class="sd">            to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        :param sig_figs: Numerical precision used for output CSV and text files.</span>
<span class="sd">            Must be an integer between 1 and 18.  If unspecified, the default</span>
<span class="sd">            precision for the system file I/O is used; the usual value is 6.</span>
<span class="sd">            Introduced in CmdStan-2.25.</span>

<span class="sd">        :param save_latent_dynamics: Whether or not to output the position and</span>
<span class="sd">            momentum information for the model parameters (unconstrained).</span>
<span class="sd">            If ``True``, CSV outputs are written to an output file</span>
<span class="sd">            &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-diagnostic-&lt;chain_id&gt;&#39;,</span>
<span class="sd">            e.g. &#39;bernoulli-201912081451-diagnostic-1.csv&#39;, see</span>
<span class="sd">            https://mc-stan.org/docs/cmdstan-guide/stan_csv.html,</span>
<span class="sd">            section &quot;Diagnostic CSV output file&quot; for details.</span>

<span class="sd">        :param save_profile: Whether or not to profile auto-diff operations in</span>
<span class="sd">            labelled blocks of code.  If ``True``, CSV outputs are written to</span>
<span class="sd">            file &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-profile-&lt;chain_id&gt;&#39;.</span>
<span class="sd">            Introduced in CmdStan-2.26, see</span>
<span class="sd">            https://mc-stan.org/docs/cmdstan-guide/stan_csv.html,</span>
<span class="sd">            section &quot;Profiling CSV output file&quot; for details.</span>

<span class="sd">        :param show_progress: If ``True``, display progress bar to track</span>
<span class="sd">            progress for warmup and sampling iterations.  Default is ``True``,</span>
<span class="sd">            unless package tqdm progress bar encounter errors.</span>

<span class="sd">        :param show_console: If ``True``, stream CmdStan messages sent to stdout</span>
<span class="sd">            and stderr to the console.  Default is ``False``.</span>

<span class="sd">        :param refresh: Specify the number of iterations CmdStan will take</span>
<span class="sd">            between progress messages. Default value is 100.</span>

<span class="sd">        :param time_fmt: A format string passed to</span>
<span class="sd">            :meth:`~datetime.datetime.strftime` to decide the file names for</span>
<span class="sd">            output CSVs. Defaults to &quot;%Y%m%d%H%M%S&quot;</span>

<span class="sd">        :param force_one_process_per_chain: If ``True``, run multiple chains in</span>
<span class="sd">            distinct processes regardless of model ability to run parallel</span>
<span class="sd">            chains (CmdStan 2.28+ feature). If ``False``, always run multiple</span>
<span class="sd">            chains in one process (does not check that this is valid).</span>

<span class="sd">            If None (Default): Check that CmdStan version is &gt;=2.28, and that</span>
<span class="sd">            model was compiled with STAN_THREADS=True, and utilize the</span>
<span class="sd">            parallel chain functionality if those conditions are met.</span>

<span class="sd">        :param timeout: Duration at which sampling times out in seconds.</span>

<span class="sd">        :return: CmdStanMCMC object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fixed_param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fixed_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_param</span>

        <span class="k">if</span> <span class="n">chains</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">chains</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Chains must be a positive integer value, found </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">chains</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">parallel_chains</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parallel_chains</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">(),</span> <span class="n">chains</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">parallel_chains</span> <span class="o">&gt;</span> <span class="n">chains</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Requested </span><span class="si">%u</span><span class="s1"> parallel_chains but only </span><span class="si">%u</span><span class="s1"> required, &#39;</span>
                <span class="s1">&#39;will run all chains in parallel.&#39;</span><span class="p">,</span>
                <span class="n">parallel_chains</span><span class="p">,</span>
                <span class="n">chains</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">parallel_chains</span> <span class="o">=</span> <span class="n">chains</span>
        <span class="k">elif</span> <span class="n">parallel_chains</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Argument parallel_chains must be a positive integer, &#39;</span>
                <span class="s1">&#39;found </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parallel_chains</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">threads_per_chain</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">threads_per_chain</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">threads_per_chain</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Argument threads_per_chain must be a positive integer, &#39;</span>
                <span class="s1">&#39;found </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">threads_per_chain</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">parallel_procs</span> <span class="o">=</span> <span class="n">parallel_chains</span>
        <span class="n">num_threads</span> <span class="o">=</span> <span class="n">threads_per_chain</span>
        <span class="n">one_process_per_chain</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">info_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe_info</span><span class="p">()</span>
        <span class="n">stan_threads</span> <span class="o">=</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;STAN_THREADS&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># run multi-chain sampler unless algo is fixed_param or 1 chain</span>
        <span class="k">if</span> <span class="n">chains</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">force_one_process_per_chain</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">force_one_process_per_chain</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">stan_threads</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span>
        <span class="p">):</span>
            <span class="n">one_process_per_chain</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">num_threads</span> <span class="o">=</span> <span class="n">parallel_chains</span> <span class="o">*</span> <span class="n">num_threads</span>
            <span class="n">parallel_procs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">force_one_process_per_chain</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">):</span>
                <span class="n">one_process_per_chain</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">num_threads</span> <span class="o">=</span> <span class="n">parallel_chains</span> <span class="o">*</span> <span class="n">num_threads</span>
                <span class="n">parallel_procs</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">stan_threads</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
                    <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;Stan program not compiled for threading, &#39;</span>
                        <span class="s1">&#39;process will run chains sequentially. &#39;</span>
                        <span class="s1">&#39;For multi-chain parallelization, recompile &#39;</span>
                        <span class="s1">&#39;the model with argument &#39;</span>
                        <span class="s1">&#39;&quot;cpp_options={</span><span class="se">\&#39;</span><span class="s1">STAN_THREADS</span><span class="se">\&#39;</span><span class="s1">:</span><span class="se">\&#39;</span><span class="s1">TRUE</span><span class="se">\&#39;</span><span class="s1">}.&#39;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;Installed version of CmdStan cannot multi-process &#39;</span>
                    <span class="s1">&#39;chains, will run </span><span class="si">%d</span><span class="s1"> processes. &#39;</span>
                    <span class="s1">&#39;Run &quot;install_cmdstan&quot; to upgrade to latest version.&#39;</span><span class="p">,</span>
                    <span class="n">chains</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;STAN_NUM_THREADS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">chain_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chains</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chain_ids</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">chain_ids</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;Chain_id must be a positive integer value,&#39;</span>
                        <span class="s1">&#39; found </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chain_ids</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">chain_ids</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chains</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">one_process_per_chain</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chain_ids</span><span class="p">,</span> <span class="n">chain_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s1">&#39;chain_ids must be sequential list of integers,&#39;</span>
                                <span class="s1">&#39; found </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chain_ids</span><span class="p">)</span>
                            <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain_ids</span><span class="p">)</span> <span class="o">==</span> <span class="n">chains</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;Chain_ids must correspond to number of chains&#39;</span>
                        <span class="s1">&#39; specified </span><span class="si">{}</span><span class="s1"> chains, found </span><span class="si">{}</span><span class="s1"> chain_ids.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">chains</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain_ids</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">chain_id</span> <span class="ow">in</span> <span class="n">chain_ids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chain_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s1">&#39;Chain_id must be a non-negative integer value,&#39;</span>
                            <span class="s1">&#39; found </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chain_id</span><span class="p">)</span>
                        <span class="p">)</span>

        <span class="n">sampler_args</span> <span class="o">=</span> <span class="n">SamplerArgs</span><span class="p">(</span>
            <span class="n">num_chains</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="n">one_process_per_chain</span> <span class="k">else</span> <span class="n">chains</span><span class="p">,</span>
            <span class="n">iter_warmup</span><span class="o">=</span><span class="n">iter_warmup</span><span class="p">,</span>
            <span class="n">iter_sampling</span><span class="o">=</span><span class="n">iter_sampling</span><span class="p">,</span>
            <span class="n">save_warmup</span><span class="o">=</span><span class="n">save_warmup</span><span class="p">,</span>
            <span class="n">thin</span><span class="o">=</span><span class="n">thin</span><span class="p">,</span>
            <span class="n">max_treedepth</span><span class="o">=</span><span class="n">max_treedepth</span><span class="p">,</span>
            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
            <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
            <span class="n">adapt_engaged</span><span class="o">=</span><span class="n">adapt_engaged</span><span class="p">,</span>
            <span class="n">adapt_delta</span><span class="o">=</span><span class="n">adapt_delta</span><span class="p">,</span>
            <span class="n">adapt_init_phase</span><span class="o">=</span><span class="n">adapt_init_phase</span><span class="p">,</span>
            <span class="n">adapt_metric_window</span><span class="o">=</span><span class="n">adapt_metric_window</span><span class="p">,</span>
            <span class="n">adapt_step_size</span><span class="o">=</span><span class="n">adapt_step_size</span><span class="p">,</span>
            <span class="n">fixed_param</span><span class="o">=</span><span class="n">fixed_param</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">temp_single_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">_data</span><span class="p">,</span> <span class="n">temp_inits</span><span class="p">(</span>
            <span class="n">inits</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">_inits</span><span class="p">:</span>
            <span class="n">cmdstan_inits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">one_process_per_chain</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inits</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># legacy</span>
                <span class="n">cmdstan_inits</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_inits</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.json&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chain_ids</span>  <span class="c1"># type: ignore</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmdstan_inits</span> <span class="o">=</span> <span class="n">_inits</span>

            <span class="n">args</span> <span class="o">=</span> <span class="n">CmdStanArgs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">,</span>
                <span class="n">chain_ids</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">_data</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="n">inits</span><span class="o">=</span><span class="n">cmdstan_inits</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
                <span class="n">sig_figs</span><span class="o">=</span><span class="n">sig_figs</span><span class="p">,</span>
                <span class="n">save_latent_dynamics</span><span class="o">=</span><span class="n">save_latent_dynamics</span><span class="p">,</span>
                <span class="n">save_profile</span><span class="o">=</span><span class="n">save_profile</span><span class="p">,</span>
                <span class="n">method_args</span><span class="o">=</span><span class="n">sampler_args</span><span class="p">,</span>
                <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">show_console</span><span class="p">:</span>
                <span class="n">show_progress</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">show_progress</span> <span class="o">=</span> <span class="n">show_progress</span> <span class="ow">and</span> <span class="n">progbar</span><span class="o">.</span><span class="n">allow_show_progress</span><span class="p">()</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CmdStan start processing&#39;</span><span class="p">)</span>

            <span class="n">progress_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="n">iter_total</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">iter_warmup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">iter_total</span> <span class="o">+=</span> <span class="n">_CMDSTAN_WARMUP</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iter_total</span> <span class="o">+=</span> <span class="n">iter_warmup</span>
                <span class="k">if</span> <span class="n">iter_sampling</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">iter_total</span> <span class="o">+=</span> <span class="n">_CMDSTAN_SAMPLING</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iter_total</span> <span class="o">+=</span> <span class="n">iter_sampling</span>
                <span class="k">if</span> <span class="n">refresh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">refresh</span> <span class="o">=</span> <span class="n">_CMDSTAN_REFRESH</span>
                <span class="n">iter_total</span> <span class="o">=</span> <span class="n">iter_total</span> <span class="o">//</span> <span class="n">refresh</span> <span class="o">+</span> <span class="mi">2</span>

                <span class="n">progress_hook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_sampler_progress_hook</span><span class="p">(</span>
                    <span class="n">chain_ids</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">,</span>
                    <span class="n">total</span><span class="o">=</span><span class="n">iter_total</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">runset</span> <span class="o">=</span> <span class="n">RunSet</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                <span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">,</span>
                <span class="n">chain_ids</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">,</span>
                <span class="n">time_fmt</span><span class="o">=</span><span class="n">time_fmt</span><span class="p">,</span>
                <span class="n">one_process_per_chain</span><span class="o">=</span><span class="n">one_process_per_chain</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">parallel_procs</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runset</span><span class="o">.</span><span class="n">num_procs</span><span class="p">):</span>
                    <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_run_cmdstan</span><span class="p">,</span>
                        <span class="n">runset</span><span class="o">=</span><span class="n">runset</span><span class="p">,</span>
                        <span class="n">idx</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
                        <span class="n">show_console</span><span class="o">=</span><span class="n">show_console</span><span class="p">,</span>
                        <span class="n">progress_hook</span><span class="o">=</span><span class="n">progress_hook</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">show_progress</span> <span class="ow">and</span> <span class="n">progress_hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">progress_hook</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># -1 == all chains finished</span>

                <span class="c1"># advance terminal window cursor past progress bars</span>
                <span class="n">term_size</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">terminal_size</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">get_terminal_size</span><span class="p">(</span>
                    <span class="n">fallback</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">term_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">term_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chains</span><span class="p">):</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">term_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CmdStan done processing.&#39;</span><span class="p">)</span>

            <span class="n">runset</span><span class="o">.</span><span class="n">raise_for_timeouts</span><span class="p">()</span>

            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;runset</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">runset</span><span class="p">))</span>

            <span class="c1"># hack needed to parse CSV files if model has no params</span>
            <span class="c1"># needed if exe is supplied without stan file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">runset</span><span class="o">.</span><span class="n">stdout_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">console_msgs</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Chain 1 console:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">console_msgs</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;running fixed_param sampler&#39;</span> <span class="ow">in</span> <span class="n">console_msgs</span><span class="p">:</span>
                    <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Detected fixed param model&quot;</span><span class="p">)</span>
                    <span class="n">sampler_args</span><span class="o">.</span><span class="n">fixed_param</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">runset</span><span class="o">.</span><span class="n">_args</span><span class="o">.</span><span class="n">method_args</span> <span class="o">=</span> <span class="n">sampler_args</span>

            <span class="n">errors</span> <span class="o">=</span> <span class="n">runset</span><span class="o">.</span><span class="n">get_err_msgs</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">runset</span><span class="o">.</span><span class="n">_check_retcodes</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Error during sampling:</span><span class="se">\n</span><span class="si">{</span><span class="n">errors</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Command and output files:</span><span class="se">\n</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">runset</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">show_console</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Consider re-running with show_console=True if the&#39;</span>
                        <span class="s1">&#39; above output is unclear!&#39;</span>
                    <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Non-fatal error during sampling:</span><span class="se">\n</span><span class="si">{</span><span class="n">errors</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">show_console</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Consider re-running with show_console=True if the&#39;</span>
                        <span class="s1">&#39; above output is unclear!&#39;</span>
                    <span class="p">)</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">mcmc</span> <span class="o">=</span> <span class="n">CmdStanMCMC</span><span class="p">(</span><span class="n">runset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mcmc</span></div>

<div class="viewcode-block" id="CmdStanModel.generate_quantities"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.generate_quantities">[docs]</a>    <span class="k">def</span> <span class="nf">generate_quantities</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">previous_fit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Fit</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gq_output_dir</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sig_figs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">show_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">mcmc_sample</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CmdStanMCMC</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CmdStanGQ</span><span class="p">[</span><span class="n">Fit</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run CmdStan&#39;s generate_quantities method which runs the generated</span>
<span class="sd">        quantities block of a model given an existing sample.</span>

<span class="sd">        This function takes one of the Stan fit objects</span>
<span class="sd">        :class:`CmdStanMCMC`, :class:`CmdStanMLE`, or :class:`CmdStanVB`</span>
<span class="sd">        and the data required for the model and calls to the CmdStan</span>
<span class="sd">        ``generate_quantities`` method to generate additional quantities of</span>
<span class="sd">        interest.</span>

<span class="sd">        The :class:`CmdStanGQ` object records the command, the return code,</span>
<span class="sd">        and the paths to the generate method output CSV and console files.</span>
<span class="sd">        The output files are written either to a specified output directory</span>
<span class="sd">        or to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        Output files are either written to a temporary directory or to the</span>
<span class="sd">        specified output directory.  Output filenames correspond to the template</span>
<span class="sd">        &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-&lt;chain_id&gt;&#39; plus the file suffix which is</span>
<span class="sd">        either &#39;.csv&#39; for the CmdStan output or &#39;.txt&#39; for</span>
<span class="sd">        the console messages, e.g. &#39;bernoulli-201912081451-1.csv&#39;.</span>
<span class="sd">        Output files written to the temporary directory contain an additional</span>
<span class="sd">        8-character random string, e.g. &#39;bernoulli-201912081451-1-5nm6as7u.csv&#39;.</span>

<span class="sd">        :param data: Values for all data variables in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the data variables,</span>
<span class="sd">            or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">        :param previous_fit: Can be either a :class:`CmdStanMCMC`,</span>
<span class="sd">            :class:`CmdStanMLE`, or :class:`CmdStanVB` or a list of</span>
<span class="sd">            stan-csv files generated by fitting the model to the data</span>
<span class="sd">            using any Stan interface.</span>

<span class="sd">        :param seed: The seed for random number generator. Must be an integer</span>
<span class="sd">            between 0 and 2^32 - 1. If unspecified,</span>
<span class="sd">            :func:`numpy.random.default_rng`</span>
<span class="sd">            is used to generate a seed which will be used for all chains.</span>
<span class="sd">            *NOTE: Specifying the seed will guarantee the same result for</span>
<span class="sd">            multiple invocations of this method with the same inputs.  However</span>
<span class="sd">            this will not reproduce results from the sample method given</span>
<span class="sd">            the same inputs because the RNG will be in a different state.*</span>

<span class="sd">        :param gq_output_dir:  Name of the directory in which the CmdStan output</span>
<span class="sd">            files are saved.  If unspecified, files will be written to a</span>
<span class="sd">            temporary directory which is deleted upon session exit.</span>

<span class="sd">        :param sig_figs: Numerical precision used for output CSV and text files.</span>
<span class="sd">            Must be an integer between 1 and 18.  If unspecified, the default</span>
<span class="sd">            precision for the system file I/O is used; the usual value is 6.</span>
<span class="sd">            Introduced in CmdStan-2.25.</span>

<span class="sd">        :param show_console: If ``True``, stream CmdStan messages sent to</span>
<span class="sd">            stdout and stderr to the console.  Default is ``False``.</span>

<span class="sd">        :param refresh: Specify the number of iterations CmdStan will take</span>
<span class="sd">            between progress messages. Default value is 100.</span>

<span class="sd">        :param time_fmt: A format string passed to</span>
<span class="sd">            :meth:`~datetime.datetime.strftime` to decide the file names for</span>
<span class="sd">            output CSVs. Defaults to &quot;%Y%m%d%H%M%S&quot;</span>

<span class="sd">        :param timeout: Duration at which generation times out in seconds.</span>

<span class="sd">        :return: CmdStanGQ object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO(2.0): remove</span>
        <span class="k">if</span> <span class="n">mcmc_sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">previous_fit</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot supply both &#39;previous_fit&#39; and &quot;</span>
                    <span class="s2">&quot;deprecated argument &#39;mcmc_sample&#39;&quot;</span>
                <span class="p">)</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Argument name `mcmc_sample` is deprecated, please &quot;</span>
                <span class="s2">&quot;rename to `previous_fit`.&quot;</span>
            <span class="p">)</span>

            <span class="n">previous_fit</span> <span class="o">=</span> <span class="n">mcmc_sample</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous_fit</span><span class="p">,</span> <span class="p">(</span><span class="n">CmdStanMCMC</span><span class="p">,</span> <span class="n">CmdStanMLE</span><span class="p">,</span> <span class="n">CmdStanVB</span><span class="p">)):</span>
            <span class="n">fit_object</span> <span class="o">=</span> <span class="n">previous_fit</span>
            <span class="n">fit_csv_files</span> <span class="o">=</span> <span class="n">previous_fit</span><span class="o">.</span><span class="n">runset</span><span class="o">.</span><span class="n">csv_files</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous_fit</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">previous_fit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Expecting list of Stan CSV files, found empty list&#39;</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fit_csv_files</span> <span class="o">=</span> <span class="n">previous_fit</span>
                <span class="n">fit_object</span> <span class="o">=</span> <span class="n">from_csv</span><span class="p">(</span><span class="n">fit_csv_files</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Invalid sample from Stan CSV files, error:</span><span class="se">\n\t</span><span class="si">{}</span><span class="se">\n\t</span><span class="s1">&#39;</span>
                    <span class="s1">&#39; while processing files</span><span class="se">\n\t</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">previous_fit</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Previous fit must be either CmdStanPy fit object&#39;</span>
                <span class="s1">&#39; or list of paths to Stan CSV files.&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fit_object</span><span class="p">,</span> <span class="n">CmdStanMCMC</span><span class="p">):</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="n">fit_object</span><span class="o">.</span><span class="n">chains</span>
            <span class="n">chain_ids</span> <span class="o">=</span> <span class="n">fit_object</span><span class="o">.</span><span class="n">chain_ids</span>
            <span class="k">if</span> <span class="n">fit_object</span><span class="o">.</span><span class="n">_save_warmup</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;Sample contains saved warmup draws which will be used &#39;</span>
                    <span class="s1">&#39;to generate additional quantities of interest.&#39;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fit_object</span><span class="p">,</span> <span class="n">CmdStanMLE</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Method generate_quantities was not &quot;</span>
                    <span class="s2">&quot;available for non-HMC until CmdStan 2.31&quot;</span>
                <span class="p">)</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fit_object</span><span class="o">.</span><span class="n">_save_iterations</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;MLE contains saved iterations which will be used &#39;</span>
                    <span class="s1">&#39;to generate additional quantities of interest.&#39;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># isinstance(fit_object, CmdStanVB)</span>
            <span class="k">if</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Method generate_quantities was not &quot;</span>
                    <span class="s2">&quot;available for non-HMC until CmdStan 2.31&quot;</span>
                <span class="p">)</span>
            <span class="n">chains</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">chain_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">generate_quantities_args</span> <span class="o">=</span> <span class="n">GenerateQuantitiesArgs</span><span class="p">(</span>
            <span class="n">csv_files</span><span class="o">=</span><span class="n">fit_csv_files</span>
        <span class="p">)</span>
        <span class="n">generate_quantities_args</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">temp_single_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">_data</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">CmdStanArgs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">,</span>
                <span class="n">chain_ids</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">_data</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">gq_output_dir</span><span class="p">,</span>
                <span class="n">sig_figs</span><span class="o">=</span><span class="n">sig_figs</span><span class="p">,</span>
                <span class="n">method_args</span><span class="o">=</span><span class="n">generate_quantities_args</span><span class="p">,</span>
                <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">runset</span> <span class="o">=</span> <span class="n">RunSet</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">,</span> <span class="n">chain_ids</span><span class="o">=</span><span class="n">chain_ids</span><span class="p">,</span> <span class="n">time_fmt</span><span class="o">=</span><span class="n">time_fmt</span>
            <span class="p">)</span>

            <span class="n">parallel_chains_avail</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span>
            <span class="n">parallel_chains</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">parallel_chains_avail</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">chains</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">parallel_chains</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chains</span><span class="p">):</span>
                    <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_run_cmdstan</span><span class="p">,</span>
                        <span class="n">runset</span><span class="p">,</span>
                        <span class="n">i</span><span class="p">,</span>
                        <span class="n">show_console</span><span class="o">=</span><span class="n">show_console</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="n">runset</span><span class="o">.</span><span class="n">raise_for_timeouts</span><span class="p">()</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">runset</span><span class="o">.</span><span class="n">get_err_msgs</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Error during generate_quantities:</span><span class="se">\n</span><span class="si">{</span><span class="n">errors</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;Command and output files:</span><span class="se">\n</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">runset</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">show_console</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Consider re-running with show_console=True if the&#39;</span>
                        <span class="s1">&#39; above output is unclear!&#39;</span>
                    <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">quantities</span> <span class="o">=</span> <span class="n">CmdStanGQ</span><span class="p">(</span><span class="n">runset</span><span class="o">=</span><span class="n">runset</span><span class="p">,</span> <span class="n">previous_fit</span><span class="o">=</span><span class="n">fit_object</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">quantities</span></div>

<div class="viewcode-block" id="CmdStanModel.variational"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.variational">[docs]</a>    <span class="k">def</span> <span class="nf">variational</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inits</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sig_figs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_latent_dynamics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">save_profile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">iter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">grad_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">elbo_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">eta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adapt_engaged</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">adapt_iter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_rel_obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">eval_elbo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">draws</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">require_converged</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">output_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CmdStanVB</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run CmdStan&#39;s variational inference algorithm to approximate</span>
<span class="sd">        the posterior distribution of the model conditioned on the data.</span>

<span class="sd">        This function validates the specified configuration, composes a call to</span>
<span class="sd">        the CmdStan ``variational`` method and spawns one subprocess to run the</span>
<span class="sd">        optimizer and waits for it to run to completion.</span>
<span class="sd">        Unspecified arguments are not included in the call to CmdStan, i.e.,</span>
<span class="sd">        those arguments will have CmdStan default values.</span>

<span class="sd">        The :class:`CmdStanVB` object records the command, the return code,</span>
<span class="sd">        and the paths to the variational method output CSV and console files.</span>
<span class="sd">        The output files are written either to a specified output directory</span>
<span class="sd">        or to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        Output files are either written to a temporary directory or to the</span>
<span class="sd">        specified output directory.  Output filenames correspond to the template</span>
<span class="sd">        &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-&lt;chain_id&gt;&#39; plus the file suffix which is</span>
<span class="sd">        either &#39;.csv&#39; for the CmdStan output or &#39;.txt&#39; for</span>
<span class="sd">        the console messages, e.g. &#39;bernoulli-201912081451-1.csv&#39;.</span>
<span class="sd">        Output files written to the temporary directory contain an additional</span>
<span class="sd">        8-character random string, e.g. &#39;bernoulli-201912081451-1-5nm6as7u.csv&#39;.</span>

<span class="sd">        :param data: Values for all data variables in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the data variables,</span>
<span class="sd">            or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">        :param seed: The seed for random number generator. Must be an integer</span>
<span class="sd">            between 0 and 2^32 - 1. If unspecified,</span>
<span class="sd">            :func:`numpy.random.default_rng`</span>
<span class="sd">            is used to generate a seed which will be used for all chains.</span>

<span class="sd">        :param inits:  Specifies how the sampler initializes parameter values.</span>
<span class="sd">            Initialization is uniform random on a range centered on 0 with</span>
<span class="sd">            default range of 2. Specifying a single number n &gt; 0 changes</span>
<span class="sd">            the initialization range to [-n, n].</span>

<span class="sd">        :param output_dir: Name of the directory to which CmdStan output</span>
<span class="sd">            files are written. If unspecified, output files will be written</span>
<span class="sd">            to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        :param sig_figs: Numerical precision used for output CSV and text files.</span>
<span class="sd">            Must be an integer between 1 and 18.  If unspecified, the default</span>
<span class="sd">            precision for the system file I/O is used; the usual value is 6.</span>
<span class="sd">            Introduced in CmdStan-2.25.</span>

<span class="sd">        :param save_latent_dynamics: Whether or not to save diagnostics.</span>
<span class="sd">            If ``True``, CSV outputs are written to output file</span>
<span class="sd">            &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-diagnostic-&lt;chain_id&gt;&#39;,</span>
<span class="sd">            e.g. &#39;bernoulli-201912081451-diagnostic-1.csv&#39;.</span>

<span class="sd">        :param save_profile: Whether or not to profile auto-diff operations in</span>
<span class="sd">            labelled blocks of code.  If ``True``, CSV outputs are written to</span>
<span class="sd">            file &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-profile-&lt;chain_id&gt;&#39;.</span>
<span class="sd">            Introduced in CmdStan-2.26.</span>

<span class="sd">        :param algorithm: Algorithm to use. One of: &#39;meanfield&#39;, &#39;fullrank&#39;.</span>

<span class="sd">        :param iter: Maximum number of ADVI iterations.</span>

<span class="sd">        :param grad_samples: Number of MC draws for computing the gradient.</span>
<span class="sd">            Default is 10.  If problems arise, try doubling current value.</span>

<span class="sd">        :param elbo_samples: Number of MC draws for estimate of ELBO.</span>

<span class="sd">        :param eta: Step size scaling parameter.</span>

<span class="sd">        :param adapt_engaged: Whether eta adaptation is engaged.</span>

<span class="sd">        :param adapt_iter: Number of iterations for eta adaptation.</span>

<span class="sd">        :param tol_rel_obj: Relative tolerance parameter for convergence.</span>

<span class="sd">        :param eval_elbo: Number of iterations between ELBO evaluations.</span>

<span class="sd">        :param draws: Number of approximate posterior output draws</span>
<span class="sd">            to save.</span>

<span class="sd">        :param require_converged: Whether or not to raise an error if Stan</span>
<span class="sd">            reports that &quot;The algorithm may not have converged&quot;.</span>

<span class="sd">        :param show_console: If ``True``, stream CmdStan messages sent to</span>
<span class="sd">            stdout and stderr to the console.  Default is ``False``.</span>

<span class="sd">        :param refresh: Specify the number of iterations CmdStan will take</span>
<span class="sd">            between progress messages. Default value is 100.</span>

<span class="sd">        :param time_fmt: A format string passed to</span>
<span class="sd">            :meth:`~datetime.datetime.strftime` to decide the file names for</span>
<span class="sd">            output CSVs. Defaults to &quot;%Y%m%d%H%M%S&quot;</span>

<span class="sd">        :param timeout: Duration at which variational Bayesian inference times</span>
<span class="sd">            out in seconds.</span>

<span class="sd">        :return: CmdStanVB object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO(2.0): remove</span>
        <span class="k">if</span> <span class="n">output_samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">draws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot supply both &#39;draws&#39; and deprecated argument &quot;</span>
                    <span class="s2">&quot;&#39;output_samples&#39;&quot;</span>
                <span class="p">)</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Argument name `output_samples` is deprecated, please &quot;</span>
                <span class="s2">&quot;rename to `draws`.&quot;</span>
            <span class="p">)</span>

            <span class="n">draws</span> <span class="o">=</span> <span class="n">output_samples</span>

        <span class="n">variational_args</span> <span class="o">=</span> <span class="n">VariationalArgs</span><span class="p">(</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
            <span class="nb">iter</span><span class="o">=</span><span class="nb">iter</span><span class="p">,</span>
            <span class="n">grad_samples</span><span class="o">=</span><span class="n">grad_samples</span><span class="p">,</span>
            <span class="n">elbo_samples</span><span class="o">=</span><span class="n">elbo_samples</span><span class="p">,</span>
            <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">,</span>
            <span class="n">adapt_engaged</span><span class="o">=</span><span class="n">adapt_engaged</span><span class="p">,</span>
            <span class="n">adapt_iter</span><span class="o">=</span><span class="n">adapt_iter</span><span class="p">,</span>
            <span class="n">tol_rel_obj</span><span class="o">=</span><span class="n">tol_rel_obj</span><span class="p">,</span>
            <span class="n">eval_elbo</span><span class="o">=</span><span class="n">eval_elbo</span><span class="p">,</span>
            <span class="n">output_samples</span><span class="o">=</span><span class="n">draws</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">temp_single_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">_data</span><span class="p">,</span> <span class="n">temp_inits</span><span class="p">(</span>
            <span class="n">inits</span><span class="p">,</span> <span class="n">allow_multiple</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">_inits</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">CmdStanArgs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">,</span>
                <span class="n">chain_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">_data</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="n">inits</span><span class="o">=</span><span class="n">_inits</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
                <span class="n">sig_figs</span><span class="o">=</span><span class="n">sig_figs</span><span class="p">,</span>
                <span class="n">save_latent_dynamics</span><span class="o">=</span><span class="n">save_latent_dynamics</span><span class="p">,</span>
                <span class="n">save_profile</span><span class="o">=</span><span class="n">save_profile</span><span class="p">,</span>
                <span class="n">method_args</span><span class="o">=</span><span class="n">variational_args</span><span class="p">,</span>
                <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">dummy_chain_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">runset</span> <span class="o">=</span> <span class="n">RunSet</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_fmt</span><span class="o">=</span><span class="n">time_fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_cmdstan</span><span class="p">(</span>
                <span class="n">runset</span><span class="p">,</span>
                <span class="n">dummy_chain_id</span><span class="p">,</span>
                <span class="n">show_console</span><span class="o">=</span><span class="n">show_console</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">runset</span><span class="o">.</span><span class="n">raise_for_timeouts</span><span class="p">()</span>

        <span class="c1"># treat failure to converge as failure</span>
        <span class="n">transcript_file</span> <span class="o">=</span> <span class="n">runset</span><span class="o">.</span><span class="n">stdout_files</span><span class="p">[</span><span class="n">dummy_chain_id</span><span class="p">]</span>
        <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;The algorithm may not have converged.&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">transcript_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">transcript</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">transcript</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">contents</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">require_converged</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s1">&#39;The algorithm may not have converged.</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;If you would like to inspect the output, &#39;</span>
                    <span class="s1">&#39;re-call with require_converged=False&#39;</span>
                <span class="p">)</span>
            <span class="c1"># else:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;The algorithm may not have converged.&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Proceeding because require_converged is set to False&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">runset</span><span class="o">.</span><span class="n">_check_retcodes</span><span class="p">():</span>
            <span class="n">transcript_file</span> <span class="o">=</span> <span class="n">runset</span><span class="o">.</span><span class="n">stdout_files</span><span class="p">[</span><span class="n">dummy_chain_id</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">transcript_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">transcript</span><span class="p">:</span>
                <span class="n">contents</span> <span class="o">=</span> <span class="n">transcript</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                <span class="sa">r</span><span class="s1">&#39;stan::variational::normal_meanfield::calc_grad:&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">contents</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">grad_samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">grad_samples</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;Variational algorithm gradient calculation failed. &#39;</span>
                    <span class="s1">&#39;Double the value of argument &quot;grad_samples&quot;, &#39;</span>
                    <span class="s1">&#39;current value is </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grad_samples</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Error during variational inference: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">runset</span><span class="o">.</span><span class="n">get_err_msgs</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># pylint: disable=invalid-name</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="n">CmdStanVB</span><span class="p">(</span><span class="n">runset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vb</span></div>

<div class="viewcode-block" id="CmdStanModel.pathfinder"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.pathfinder">[docs]</a>    <span class="k">def</span> <span class="nf">pathfinder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">init_alpha</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_rel_obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_grad</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_rel_grad</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tol_param</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">history_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_paths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_lbfgs_iters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">draws</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_single_draws</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_elbo_draws</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">psis_resample</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">calculate_lp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1"># arguments standard to all methods</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sig_figs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_profile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CmdStanPathfinder</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run CmdStan&#39;s Pathfinder variational inference algorithm.</span>

<span class="sd">        :param data: Values for all data variables in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the data variables,</span>
<span class="sd">            or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">        :param num_paths: Number of single-path Pathfinders to run.</span>
<span class="sd">            Default is 4, when the number of paths is 1 then no importance</span>
<span class="sd">            sampling is done.</span>

<span class="sd">        :param draws: Number of approximate draws to return.</span>

<span class="sd">        :param num_single_draws: Number of draws each single-pathfinder will</span>
<span class="sd">            draw.</span>
<span class="sd">            If ``num_paths`` is 1, only one of this and ``draws`` should be</span>
<span class="sd">            used.</span>

<span class="sd">        :param max_lbfgs_iters: Maximum number of L-BFGS iterations.</span>

<span class="sd">        :param num_elbo_draws: Number of Monte Carlo draws to evaluate ELBO.</span>

<span class="sd">        :param psis_resample: Whether or not to use Pareto Smoothed Importance</span>
<span class="sd">            Sampling on the result of the individual Pathfinders. If False, the</span>
<span class="sd">            result contains the draws from each path.</span>

<span class="sd">        :param calculate_lp: Whether or not to calculate the log probability</span>
<span class="sd">            for approximate draws. If False, this also implies that</span>
<span class="sd">            ``psis_resample`` will be set to False.</span>

<span class="sd">        :param seed: The seed for random number generator. Must be an integer</span>
<span class="sd">            between 0 and 2^32 - 1. If unspecified,</span>
<span class="sd">            :func:`numpy.random.default_rng` is used to generate a seed.</span>

<span class="sd">        :param inits: Specifies how the algorithm initializes parameter values.</span>
<span class="sd">            Initialization is either uniform random on a range centered on 0,</span>
<span class="sd">            exactly 0, or a dictionary or file of initial values for some or all</span>
<span class="sd">            parameters in the model.  The default initialization behavior will</span>
<span class="sd">            initialize all parameter values on range [-2, 2] on the</span>
<span class="sd">            *unconstrained* support.  If the expected parameter values are</span>
<span class="sd">            too far from this range, this option may improve adaptation.</span>
<span class="sd">            The following value types are allowed:</span>

<span class="sd">            * Single number n &gt; 0 - initialization range is [-n, n].</span>
<span class="sd">            * 0 - all parameters are initialized to 0.</span>
<span class="sd">            * dictionary - pairs parameter name : initial value.</span>
<span class="sd">            * string - pathname to a JSON or Rdump data file.</span>
<span class="sd">            * list of strings - per-path pathname to data file.</span>
<span class="sd">            * list of dictionaries - per-path initial values.</span>

<span class="sd">        :param init_alpha: For internal L-BFGS: Line search step size for</span>
<span class="sd">            first iteration</span>

<span class="sd">        :param tol_obj: For internal L-BFGS: Convergence tolerance on changes</span>
<span class="sd">            in objective function value</span>

<span class="sd">        :param tol_rel_obj: For internal L-BFGS: Convergence tolerance on</span>
<span class="sd">            relative changes in objective function value</span>

<span class="sd">        :param tol_grad: For internal L-BFGS: Convergence tolerance on the</span>
<span class="sd">            norm of the gradient</span>

<span class="sd">        :param tol_rel_grad: For internal L-BFGS: Convergence tolerance on</span>
<span class="sd">            the relative norm of the gradient</span>

<span class="sd">        :param tol_param: For internal L-BFGS: Convergence tolerance on changes</span>
<span class="sd">            in parameter value</span>

<span class="sd">        :param history_size: For internal L-BFGS: Size of the history for LBFGS</span>
<span class="sd">            Hessian approximation. The value should be less than the</span>
<span class="sd">            dimensionality of the parameter space. 5-10 is usually sufficient</span>

<span class="sd">        :param output_dir: Name of the directory to which CmdStan output</span>
<span class="sd">            files are written. If unspecified, output files will be written</span>
<span class="sd">            to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        :param sig_figs: Numerical precision used for output CSV and text files.</span>
<span class="sd">            Must be an integer between 1 and 18.  If unspecified, the default</span>
<span class="sd">            precision for the system file I/O is used; the usual value is 6.</span>
<span class="sd">            Introduced in CmdStan-2.25.</span>

<span class="sd">        :param save_profile: Whether or not to profile auto-diff operations in</span>
<span class="sd">            labelled blocks of code.  If ``True``, CSV outputs are written to</span>
<span class="sd">            file &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-profile-&lt;path_id&gt;&#39;.</span>
<span class="sd">            Introduced in CmdStan-2.26, see</span>
<span class="sd">            https://mc-stan.org/docs/cmdstan-guide/stan_csv.html,</span>
<span class="sd">            section &quot;Profiling CSV output file&quot; for details.</span>

<span class="sd">        :param show_console: If ``True``, stream CmdStan messages sent to stdout</span>
<span class="sd">            and stderr to the console.  Default is ``False``.</span>

<span class="sd">        :param refresh: Specify the number of iterations CmdStan will take</span>
<span class="sd">            between progress messages. Default value is 100.</span>

<span class="sd">        :param time_fmt: A format string passed to</span>
<span class="sd">            :meth:`~datetime.datetime.strftime` to decide the file names for</span>
<span class="sd">            output CSVs. Defaults to &quot;%Y%m%d%H%M%S&quot;</span>

<span class="sd">        :param timeout: Duration at which Pathfinder times</span>
<span class="sd">            out in seconds. Defaults to None.</span>

<span class="sd">        :return: A :class:`CmdStanPathfinder` object</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        Zhang, L., Carpenter, B., Gelman, A., &amp; Vehtari, A. (2022). Pathfinder:</span>
<span class="sd">        Parallel quasi-Newton variational inference. Journal of Machine Learning</span>
<span class="sd">        Research, 23(306), 1–49. Retrieved from</span>
<span class="sd">        http://jmlr.org/papers/v23/21-0889.html</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">exe_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="n">exe_info</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Method &#39;pathfinder&#39; not available for CmdStan versions &quot;</span>
                <span class="s2">&quot;before 2.33&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">psis_resample</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">calculate_lp</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cmdstan_version_before</span><span class="p">(</span>
            <span class="mi">2</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="n">exe_info</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Arguments &#39;psis_resample&#39; and &#39;calculate_lp&#39; are only &quot;</span>
                <span class="s2">&quot;available for CmdStan versions 2.34 and later&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">num_paths</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num_single_draws</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num_single_draws</span> <span class="o">=</span> <span class="n">draws</span>
            <span class="k">if</span> <span class="n">draws</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">num_single_draws</span> <span class="o">!=</span> <span class="n">draws</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot specify both &#39;draws&#39; and &#39;num_single_draws&#39;&quot;</span>
                    <span class="s2">&quot; when &#39;num_paths&#39; is 1&quot;</span>
                <span class="p">)</span>

        <span class="n">pathfinder_args</span> <span class="o">=</span> <span class="n">PathfinderArgs</span><span class="p">(</span>
            <span class="n">init_alpha</span><span class="o">=</span><span class="n">init_alpha</span><span class="p">,</span>
            <span class="n">tol_obj</span><span class="o">=</span><span class="n">tol_obj</span><span class="p">,</span>
            <span class="n">tol_rel_obj</span><span class="o">=</span><span class="n">tol_rel_obj</span><span class="p">,</span>
            <span class="n">tol_grad</span><span class="o">=</span><span class="n">tol_grad</span><span class="p">,</span>
            <span class="n">tol_rel_grad</span><span class="o">=</span><span class="n">tol_rel_grad</span><span class="p">,</span>
            <span class="n">tol_param</span><span class="o">=</span><span class="n">tol_param</span><span class="p">,</span>
            <span class="n">history_size</span><span class="o">=</span><span class="n">history_size</span><span class="p">,</span>
            <span class="n">num_psis_draws</span><span class="o">=</span><span class="n">draws</span><span class="p">,</span>
            <span class="n">num_paths</span><span class="o">=</span><span class="n">num_paths</span><span class="p">,</span>
            <span class="n">max_lbfgs_iters</span><span class="o">=</span><span class="n">max_lbfgs_iters</span><span class="p">,</span>
            <span class="n">num_draws</span><span class="o">=</span><span class="n">num_single_draws</span><span class="p">,</span>
            <span class="n">num_elbo_draws</span><span class="o">=</span><span class="n">num_elbo_draws</span><span class="p">,</span>
            <span class="n">psis_resample</span><span class="o">=</span><span class="n">psis_resample</span><span class="p">,</span>
            <span class="n">calculate_lp</span><span class="o">=</span><span class="n">calculate_lp</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">temp_single_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">_data</span><span class="p">,</span> <span class="n">temp_inits</span><span class="p">(</span><span class="n">inits</span><span class="p">)</span> <span class="k">as</span> <span class="n">_inits</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">CmdStanArgs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">,</span>
                <span class="n">chain_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">_data</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="n">inits</span><span class="o">=</span><span class="n">_inits</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
                <span class="n">sig_figs</span><span class="o">=</span><span class="n">sig_figs</span><span class="p">,</span>
                <span class="n">save_profile</span><span class="o">=</span><span class="n">save_profile</span><span class="p">,</span>
                <span class="n">method_args</span><span class="o">=</span><span class="n">pathfinder_args</span><span class="p">,</span>
                <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dummy_chain_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">runset</span> <span class="o">=</span> <span class="n">RunSet</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_fmt</span><span class="o">=</span><span class="n">time_fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_cmdstan</span><span class="p">(</span>
                <span class="n">runset</span><span class="p">,</span>
                <span class="n">dummy_chain_id</span><span class="p">,</span>
                <span class="n">show_console</span><span class="o">=</span><span class="n">show_console</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">runset</span><span class="o">.</span><span class="n">raise_for_timeouts</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">runset</span><span class="o">.</span><span class="n">_check_retcodes</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error during Pathfinder! Command &#39;</span><span class="si">{}</span><span class="s2">&#39; failed: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">runset</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">runset</span><span class="o">.</span><span class="n">get_err_msgs</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CmdStanPathfinder</span><span class="p">(</span><span class="n">runset</span><span class="p">)</span></div>

<div class="viewcode-block" id="CmdStanModel.log_prob"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.log_prob">[docs]</a>    <span class="k">def</span> <span class="nf">log_prob</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">jacobian</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">sig_figs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the log probability and gradient at the given parameter</span>
<span class="sd">        values.</span>

<span class="sd">        .. note:: This function is **NOT** an efficient way to evaluate the log</span>
<span class="sd">            density of the model. It should be used for diagnostics ONLY.</span>
<span class="sd">            Please, do not use this for other purposes such as testing new</span>
<span class="sd">            sampling algorithms!</span>

<span class="sd">        :param params: Values for all parameters in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the parameter</span>
<span class="sd">            variables, or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">            These should be given on the constrained (natural) scale.</span>

<span class="sd">        :param data: Values for all data variables in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the data variables,</span>
<span class="sd">            or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">        :param jacobian: Whether or not to enable the Jacobian adjustment</span>
<span class="sd">            for constrained parameters. Defaults to ``True``.</span>

<span class="sd">        :param sig_figs: Numerical precision used for output CSV and text files.</span>
<span class="sd">            Must be an integer between 1 and 18.  If unspecified, the default</span>
<span class="sd">            precision for the system file I/O is used; the usual value is 6.</span>

<span class="sd">        :return: A pandas.DataFrame containing columns &quot;lp__&quot; and additional</span>
<span class="sd">            columns for the gradient values. These gradients will be for the</span>
<span class="sd">            unconstrained parameters of the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe_info</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Method &#39;log_prob&#39; not available for CmdStan versions &quot;</span>
                <span class="s2">&quot;before 2.31&quot;</span>
            <span class="p">)</span>
        <span class="k">with</span> <span class="n">temp_single_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">_data</span><span class="p">,</span> <span class="n">temp_single_json</span><span class="p">(</span>
            <span class="n">params</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">_params</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exe_file</span><span class="p">),</span>
                <span class="s2">&quot;log_prob&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;constrained_params=</span><span class="si">{</span><span class="n">_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;jacobian=</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">jacobian</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;file=</span><span class="si">{</span><span class="n">_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

            <span class="n">output_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">_TMPDIR</span><span class="p">)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;output.csv&quot;</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;file=</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sig_figs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sig_figs=</span><span class="si">{</span><span class="n">sig_figs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cmd: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>

            <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
                <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;log_prob&#39; command failed!</span><span class="se">\n</span><span class="s2">stdout:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">stderr:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                    <span class="n">proc</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Method &#39;log_prob&#39; failed with return code &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="CmdStanModel.laplace_sample"><a class="viewcode-back" href="../../api.html#cmdstanpy.CmdStanModel.laplace_sample">[docs]</a>    <span class="k">def</span> <span class="nf">laplace_sample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CmdStanMLE</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">draws</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">jacobian</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># NB: Different than optimize!</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">OptionalPath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sig_figs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_profile</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">opt_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CmdStanLaplace</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a Laplace approximation around the posterior mode.</span>

<span class="sd">        :param data: Values for all data variables in the model, specified</span>
<span class="sd">            either as a dictionary with entries matching the data variables,</span>
<span class="sd">            or as the path of a data file in JSON or Rdump format.</span>

<span class="sd">        :param mode: The mode around which to place the approximation, either</span>

<span class="sd">            * A :class:`CmdStanMLE` object</span>
<span class="sd">            * A path to a CSV file containing the output of an optimization run.</span>
<span class="sd">            * ``None`` - use default optimizer settings and/or any ``opt_args``.</span>

<span class="sd">        :param draws: Number of approximate draws to return.</span>
<span class="sd">            Defaults to 1000</span>

<span class="sd">        :param jacobian: Whether or not to enable the Jacobian adjustment</span>
<span class="sd">            for constrained parameters. Defaults to ``True``.</span>
<span class="sd">            Note: This must match the argument used in the creation of</span>
<span class="sd">            ``mode``, if supplied.</span>

<span class="sd">        :param output_dir: Name of the directory to which CmdStan output</span>
<span class="sd">            files are written. If unspecified, output files will be written</span>
<span class="sd">            to a temporary directory which is deleted upon session exit.</span>

<span class="sd">        :param sig_figs: Numerical precision used for output CSV and text files.</span>
<span class="sd">            Must be an integer between 1 and 18.  If unspecified, the default</span>
<span class="sd">            precision for the system file I/O is used; the usual value is 6.</span>
<span class="sd">            Introduced in CmdStan-2.25.</span>

<span class="sd">        :param save_profile: Whether or not to profile auto-diff operations in</span>
<span class="sd">            labelled blocks of code.  If ``True``, CSV outputs are written to</span>
<span class="sd">            file &#39;&lt;model_name&gt;-&lt;YYYYMMDDHHMM&gt;-profile-&lt;path_id&gt;&#39;.</span>
<span class="sd">            Introduced in CmdStan-2.26, see</span>
<span class="sd">            https://mc-stan.org/docs/cmdstan-guide/stan_csv.html,</span>
<span class="sd">            section &quot;Profiling CSV output file&quot; for details.</span>

<span class="sd">        :param show_console: If ``True``, stream CmdStan messages sent to stdout</span>
<span class="sd">            and stderr to the console.  Default is ``False``.</span>

<span class="sd">        :param refresh: Specify the number of iterations CmdStan will take</span>
<span class="sd">            between progress messages. Default value is 100.</span>

<span class="sd">        :param time_fmt: A format string passed to</span>
<span class="sd">            :meth:`~datetime.datetime.strftime` to decide the file names for</span>
<span class="sd">            output CSVs. Defaults to &quot;%Y%m%d%H%M%S&quot;</span>

<span class="sd">        :param timeout: Duration at which Pathfinder times</span>
<span class="sd">            out in seconds. Defaults to None.</span>

<span class="sd">        :param opt_args: Dictionary of additional arguments</span>
<span class="sd">            which will be passed to :meth:`~CmdStanModel.optimize`</span>

<span class="sd">        :return: A :class:`CmdStanLaplace` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cmdstan_version_before</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe_info</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Method &#39;laplace_sample&#39; not available for CmdStan versions &quot;</span>
                <span class="s2">&quot;before 2.32&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">opt_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot specify both &#39;opt_args&#39; and &#39;mode&#39; arguments&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">optimize_args</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="p">,</span>
                <span class="s2">&quot;sig_figs&quot;</span><span class="p">:</span> <span class="n">sig_figs</span><span class="p">,</span>
                <span class="s2">&quot;jacobian&quot;</span><span class="p">:</span> <span class="n">jacobian</span><span class="p">,</span>
                <span class="s2">&quot;save_profile&quot;</span><span class="p">:</span> <span class="n">save_profile</span><span class="p">,</span>
                <span class="s2">&quot;show_console&quot;</span><span class="p">:</span> <span class="n">show_console</span><span class="p">,</span>
                <span class="s2">&quot;refresh&quot;</span><span class="p">:</span> <span class="n">refresh</span><span class="p">,</span>
                <span class="s2">&quot;time_fmt&quot;</span><span class="p">:</span> <span class="n">time_fmt</span><span class="p">,</span>
                <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="n">timeout</span><span class="p">,</span>
                <span class="s2">&quot;output_dir&quot;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">optimize_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opt_args</span> <span class="ow">or</span> <span class="p">{})</span>
            <span class="n">optimize_args</span><span class="p">[</span><span class="s1">&#39;time_fmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;opt-&#39;</span> <span class="o">+</span> <span class="n">time_fmt</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cmdstan_mode</span><span class="p">:</span> <span class="n">CmdStanMLE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">optimize_args</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to run optimizer on model. &quot;</span>
                    <span class="s2">&quot;Consider supplying a mode or additional optimizer args&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">CmdStanMLE</span><span class="p">):</span>
            <span class="n">cmdstan_mode</span> <span class="o">=</span> <span class="n">from_csv</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>  <span class="c1"># type: ignore  # we check below</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmdstan_mode</span> <span class="o">=</span> <span class="n">mode</span>

        <span class="k">if</span> <span class="n">cmdstan_mode</span><span class="o">.</span><span class="n">runset</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="n">Method</span><span class="o">.</span><span class="n">OPTIMIZE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Mode must be a CmdStanMLE or a path to an optimize CSV&quot;</span>
            <span class="p">)</span>

        <span class="n">mode_jacobian</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">cmdstan_mode</span><span class="o">.</span><span class="n">runset</span><span class="o">.</span><span class="n">_args</span><span class="o">.</span><span class="n">method_args</span><span class="o">.</span><span class="n">jacobian</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">mode_jacobian</span> <span class="o">!=</span> <span class="n">jacobian</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Jacobian argument to optimize and laplace must match!</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Laplace was run with jacobian=</span><span class="si">{</span><span class="n">jacobian</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but optimize was run with jacobian=</span><span class="si">{</span><span class="n">mode_jacobian</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">laplace_args</span> <span class="o">=</span> <span class="n">LaplaceArgs</span><span class="p">(</span>
            <span class="n">cmdstan_mode</span><span class="o">.</span><span class="n">runset</span><span class="o">.</span><span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">draws</span><span class="p">,</span> <span class="n">jacobian</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">temp_single_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">_data</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">CmdStanArgs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exe_file</span><span class="p">,</span>
                <span class="n">chain_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">_data</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
                <span class="n">sig_figs</span><span class="o">=</span><span class="n">sig_figs</span><span class="p">,</span>
                <span class="n">save_profile</span><span class="o">=</span><span class="n">save_profile</span><span class="p">,</span>
                <span class="n">method_args</span><span class="o">=</span><span class="n">laplace_args</span><span class="p">,</span>
                <span class="n">refresh</span><span class="o">=</span><span class="n">refresh</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dummy_chain_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">runset</span> <span class="o">=</span> <span class="n">RunSet</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_fmt</span><span class="o">=</span><span class="n">time_fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_cmdstan</span><span class="p">(</span>
                <span class="n">runset</span><span class="p">,</span>
                <span class="n">dummy_chain_id</span><span class="p">,</span>
                <span class="n">show_console</span><span class="o">=</span><span class="n">show_console</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">runset</span><span class="o">.</span><span class="n">raise_for_timeouts</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">CmdStanLaplace</span><span class="p">(</span><span class="n">runset</span><span class="p">,</span> <span class="n">cmdstan_mode</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_run_cmdstan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">runset</span><span class="p">:</span> <span class="n">RunSet</span><span class="p">,</span>
        <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">show_console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">progress_hook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function which encapsulates call to CmdStan.</span>
<span class="sd">        Uses subprocess POpen object to run the process.</span>
<span class="sd">        Records stdout, stderr messages, and process returncode.</span>
<span class="sd">        Args &#39;show_progress&#39; and &#39;show_console&#39; allow use of progress bar,</span>
<span class="sd">        streaming output to console, respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;idx </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;running CmdStan, num_threads: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;STAN_NUM_THREADS&#39;</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="n">logger_prefix</span> <span class="o">=</span> <span class="s1">&#39;CmdStan&#39;</span>
        <span class="n">console_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">runset</span><span class="o">.</span><span class="n">one_process_per_chain</span><span class="p">:</span>
            <span class="n">logger_prefix</span> <span class="o">=</span> <span class="s1">&#39;Chain [</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">runset</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">console_prefix</span> <span class="o">=</span> <span class="s1">&#39;Chain [</span><span class="si">{}</span><span class="s1">] &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">runset</span><span class="o">.</span><span class="n">chain_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">runset</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;CmdStan args: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">show_progress</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> start processing&#39;</span><span class="p">,</span> <span class="n">logger_prefix</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fd_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">runset</span><span class="o">.</span><span class="n">stdout_files</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span>
                <span class="n">bufsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>  <span class="c1"># avoid buffer overflow</span>
                <span class="n">env</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
                <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">timer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>

                <span class="k">def</span> <span class="nf">_timer_target</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Abort if the process has already terminated.</span>
                    <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="n">proc</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                    <span class="n">runset</span><span class="o">.</span><span class="n">_set_timeout_flag</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

                <span class="n">timer</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span> <span class="n">_timer_target</span><span class="p">)</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timer</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">while</span> <span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">fd_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">show_console</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">console_prefix</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">progress_hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">progress_hook</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

            <span class="n">stdout</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
            <span class="n">retcode</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span>
            <span class="n">runset</span><span class="o">.</span><span class="n">_set_retcode</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">retcode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">timer</span><span class="p">:</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">stdout</span><span class="p">:</span>
                <span class="n">fd_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_console</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">console_prefix</span><span class="si">}{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fd_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Failed with error </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">fd_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">show_progress</span><span class="p">:</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> done processing&#39;</span><span class="p">,</span> <span class="n">logger_prefix</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">retcode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">retcode_summary</span> <span class="o">=</span> <span class="n">returncode_msg</span><span class="p">(</span><span class="n">retcode</span><span class="p">)</span>
            <span class="n">serror</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">serror</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">strerror</span><span class="p">(</span><span class="n">retcode</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ArithmeticError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> error: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">logger_prefix</span><span class="p">,</span> <span class="n">retcode_summary</span><span class="p">,</span> <span class="n">serror</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@progbar</span><span class="o">.</span><span class="n">wrap_callback</span>
    <span class="k">def</span> <span class="nf">_wrap_sampler_progress_hook</span><span class="p">(</span>
        <span class="n">chain_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">total</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up tqdm callback for CmdStan sampler console msgs.</span>
<span class="sd">        CmdStan progress messages start with &quot;Iteration&quot;, for single chain</span>
<span class="sd">        process, &quot;Chain [id] Iteration&quot; for multi-chain processing.</span>
<span class="sd">        For the latter, manage array of pbars, update accordingly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Chain \[(\d*)\] (Iteration.*)&#39;</span><span class="p">)</span>
        <span class="n">pbars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">tqdm</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">chain_id</span><span class="p">:</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
                <span class="n">bar_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{desc}</span><span class="s2"> |</span><span class="si">{bar}</span><span class="s2">| </span><span class="si">{elapsed}</span><span class="s2"> </span><span class="si">{postfix[0][value]}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">postfix</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Status&quot;</span><span class="p">}],</span>
                <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;chain </span><span class="si">{</span><span class="n">chain_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">chain_id</span> <span class="ow">in</span> <span class="n">chain_ids</span>
        <span class="p">}</span>

        <span class="k">def</span> <span class="nf">progress_hook</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;Done&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pbar</span> <span class="ow">in</span> <span class="n">pbars</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">postfix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sampling completed&#39;</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">pbar</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">mline</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Iteration&quot;</span><span class="p">):</span>
                    <span class="n">mline</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">chain_ids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">if</span> <span class="s1">&#39;Sampling&#39;</span> <span class="ow">in</span> <span class="n">mline</span><span class="p">:</span>
                    <span class="n">pbars</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
                <span class="n">pbars</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">pbars</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">postfix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mline</span>

        <span class="k">return</span> <span class="n">progress_hook</span></div>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2023, Stan Development Team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>